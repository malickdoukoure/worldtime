<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorldTime ‚Äî Horaires Mondiaux</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,600;1,300&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f0e8;
    --ink: #1a1208;
    --muted: #8a7a60;
    --accent: #c8410a;
    --accent2: #1a6b3c;
    --surface: #ede8de;
    --border: #d4c9b0;
    --highlight: #fff9ee;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--ink); font-family: 'DM Sans', sans-serif; min-height: 100vh; }
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1000;
    opacity: 0.5;
  }
  header {
    padding: 24px 40px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid var(--ink);
    position: sticky;
    top: 0;
    background: var(--bg);
    z-index: 100;
    gap: 16px;
    flex-wrap: wrap;
  }
  .logo { font-family: 'Bebas Neue', cursive; font-size: 2rem; letter-spacing: 0.05em; color: var(--ink); line-height: 1; }
  .logo span { color: var(--accent); }
  .header-right { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
  #my-location { font-family: 'DM Mono', monospace; font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; white-space: nowrap; }
  #my-location strong { color: var(--accent); font-weight: 500; }
  .search-wrap { position: relative; }
  #search {
    background: var(--surface);
    border: 1.5px solid var(--border);
    padding: 9px 16px 9px 38px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--ink);
    width: 260px;
    outline: none;
    transition: border-color 0.2s;
  }
  #search:focus { border-color: var(--ink); }
  #search::placeholder { color: var(--muted); }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); pointer-events: none; font-size: 0.9rem; }
  .hero {
    padding: 48px 40px 32px;
    display: flex;
    align-items: flex-end;
    gap: 28px;
    border-bottom: 1px solid var(--border);
  }
  .hero-time { font-family: 'Bebas Neue', cursive; font-size: clamp(5rem, 12vw, 9rem); line-height: 0.88; letter-spacing: -0.01em; }
  .hero-info { padding-bottom: 10px; }
  .hero-country { font-size: 1rem; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px; }
  .hero-date { font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .hero-tz { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); margin-top: 5px; }
  .filters { padding: 18px 40px; display: flex; gap: 8px; flex-wrap: wrap; border-bottom: 1px solid var(--border); }
  .filter-btn {
    padding: 6px 13px;
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border: 1.5px solid var(--border);
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }
  .filter-btn:hover, .filter-btn.active { background: var(--ink); border-color: var(--ink); color: var(--bg); }
  .grid-header { padding: 18px 40px 12px; display: flex; align-items: center; justify-content: space-between; }
  .grid-title { font-family: 'Bebas Neue', cursive; font-size: 1.3rem; letter-spacing: 0.05em; color: var(--muted); }
  .count { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
  .card {
    padding: 22px 26px;
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    background: var(--bg);
    transition: background 0.15s;
    position: relative;
    overflow: hidden;
  }
  .card:hover { background: var(--highlight); }
  .card.me { background: var(--ink); color: var(--bg); }
  .card.me:hover { background: #2a1e08; }
  .card.me .card-country { color: #4ade80; }
  .card.me .card-offset, .card.me .card-date, .card.me .card-tz { color: rgba(245,240,232,0.45); }
  .card.me .you-badge { display: inline-block; }
  .you-badge {
    display: none;
    background: var(--accent);
    color: white;
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 2px 6px;
    margin-left: 7px;
    vertical-align: middle;
  }
  .card-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 12px; }
  .card-flag { font-size: 1.5rem; line-height: 1; }
  .card-offset { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--muted); text-transform: uppercase; padding-top: 4px; }
  .card-country { font-size: 0.82rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--accent2); margin-bottom: 2px; }
  .card-time { font-family: 'Bebas Neue', cursive; font-size: 2.6rem; line-height: 1; letter-spacing: 0.02em; margin-bottom: 3px; }
  .card-date { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.04em; }
  .card-tz { font-family: 'DM Mono', monospace; font-size: 0.6rem; color: var(--border); margin-top: 7px; }
  .day-bar { height: 2px; background: var(--border); margin-top: 10px; overflow: hidden; }
  .day-fill { height: 100%; background: var(--accent); transition: width 1s linear; }
  .card.me .day-bar { background: rgba(255,255,255,0.1); }
  .empty-state { grid-column: 1/-1; padding: 80px 40px; text-align: center; color: var(--muted); font-family: 'DM Mono', monospace; font-size: 0.82rem; text-transform: uppercase; letter-spacing: 0.1em; }
  /* Visitors panel */
  .visitors-bar {
    padding: 14px 40px;
    background: var(--ink);
    color: var(--bg);
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
    border-bottom: 2px solid var(--accent);
  }
  .visitors-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(245,240,232,0.5);
    white-space: nowrap;
  }
  .visitors-count {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.5rem;
    color: var(--accent);
    line-height: 1;
  }
  .visitors-sep {
    width: 1px;
    height: 24px;
    background: rgba(245,240,232,0.15);
  }
  .visitors-list {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    flex: 1;
  }
  .visitor-chip {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    padding: 3px 10px;
    border: 1px solid rgba(245,240,232,0.15);
    color: rgba(245,240,232,0.75);
    display: flex;
    align-items: center;
    gap: 5px;
    animation: chipIn 0.4s ease;
  }
  @keyframes chipIn {
    from { opacity: 0; transform: translateY(-4px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .visitor-chip .chip-flag { font-size: 0.9rem; }
  .live-dot {
    width: 6px; height: 6px;
    background: #4ade80;
    border-radius: 50%;
    animation: pulse 2s infinite;
    flex-shrink: 0;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* ‚îÄ‚îÄ Contact footer ‚îÄ‚îÄ */
  .contact-section {
    margin-top: 60px;
    border-top: 2px solid var(--ink);
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
  .contact-left {
    padding: 48px 40px;
    border-right: 1px solid var(--border);
  }
  .contact-right { padding: 48px 40px; }
  .contact-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 3rem;
    line-height: 0.95;
    letter-spacing: 0.02em;
    margin-bottom: 16px;
  }
  .contact-title span { color: var(--accent); }
  .contact-sub {
    font-family: 'DM Mono', monospace;
    font-size: 0.75rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    line-height: 1.8;
  }
  .contact-form { display: flex; flex-direction: column; gap: 12px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .form-field { display: flex; flex-direction: column; gap: 5px; }
  .form-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
  }
  .form-input, .form-textarea {
    background: var(--surface);
    border: 1.5px solid var(--border);
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s;
    resize: none;
    width: 100%;
  }
  .form-input:focus, .form-textarea:focus { border-color: var(--ink); }
  .form-input::placeholder, .form-textarea::placeholder { color: var(--muted); }
  .form-textarea { height: 110px; }
  .form-submit {
    background: var(--ink);
    color: var(--bg);
    border: none;
    padding: 12px 28px;
    font-family: 'Bebas Neue', cursive;
    font-size: 1.1rem;
    letter-spacing: 0.08em;
    cursor: pointer;
    transition: background 0.2s;
    align-self: flex-start;
  }
  .form-submit:hover { background: var(--accent); }
  .form-submit:disabled { opacity: 0.5; cursor: not-allowed; }
  .form-success {
    display: none;
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    color: var(--accent2);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 10px 0;
  }
  .form-success.show { display: block; }
  .contact-bottom {
    grid-column: 1/-1;
    padding: 18px 40px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
  }

  @media (max-width: 640px) {
    header { padding: 14px 18px; }
    #search { width: 200px; }
    .hero { padding: 28px 18px; flex-direction: column; gap: 10px; }
    .filters, .grid-header { padding-left: 18px; padding-right: 18px; }
    .grid { grid-template-columns: 1fr 1fr; }
    .card { padding: 14px; }
    .card-time { font-size: 2rem; }
    .visitors-bar { padding: 12px 18px; }
    .contact-section { grid-template-columns: 1fr; }
    .contact-left { border-right: none; border-bottom: 1px solid var(--border); padding: 32px 18px; }
    .contact-right { padding: 32px 18px; }
    .form-row { grid-template-columns: 1fr; }
    .contact-bottom { padding: 14px 18px; flex-direction: column; gap: 6px; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">World<span>Time</span></div>
  <div class="header-right">
    <div id="my-location">üìç D√©tection...</div>
    <div class="search-wrap">
      <span class="search-icon">‚åï</span>
      <input type="text" id="search" placeholder="Rechercher un pays...">
    </div>
  </div>
</header>

<div class="hero">
  <div class="hero-time" id="hero-time">--:--:--</div>
  <div class="hero-info">
    <div class="hero-country" id="hero-country">D√©tection en cours...</div>
    <div class="hero-date" id="hero-date"></div>
    <div class="hero-tz" id="hero-tz"></div>
  </div>
</div>

<div class="visitors-bar">
  <div style="display:flex;align-items:center;gap:8px;">
    <div class="live-dot"></div>
    <span class="visitors-label">Visiteurs</span>
  </div>
  <div class="visitors-count" id="visit-count">‚Äî</div>
  <div class="visitors-sep"></div>
  <div class="visitors-label">En ligne r√©cemment :</div>
  <div class="visitors-list" id="visitors-list">
    <span style="font-family:'DM Mono',monospace;font-size:0.68rem;color:rgba(245,240,232,0.3);">Chargement...</span>
  </div>
</div>

<div class="filters">
  <button class="filter-btn active" data-region="all">Tous</button>
  <button class="filter-btn" data-region="Europe">Europe</button>
  <button class="filter-btn" data-region="Am√©rique">Am√©rique</button>
  <button class="filter-btn" data-region="Asie">Asie</button>
  <button class="filter-btn" data-region="Afrique">Afrique</button>
  <button class="filter-btn" data-region="Oc√©anie">Oc√©anie</button>
</div>

<div class="grid-header">
  <div class="grid-title">Horaires du monde</div>
  <div class="count" id="count"></div>
</div>

<div class="grid" id="grid"></div>

<!-- Contact -->
<section class="contact-section" id="contact">
  <div class="contact-left">
    <div class="contact-title">Contacter<br>le <span>Dev</span></div>
    <div class="contact-sub">
      Une id√©e ?<br>
      Un bug ?<br>
      Une suggestion ?<br>
      √âcris-moi directement.
    </div>
  </div>
  <div class="contact-right">
    <form class="contact-form" id="contact-form">
      <div class="form-row">
        <div class="form-field">
          <label class="form-label">Nom</label>
          <input class="form-input" type="text" name="name" placeholder="Ton nom" required>
        </div>
        <div class="form-field">
          <label class="form-label">Email</label>
          <input class="form-input" type="email" name="email" placeholder="ton@email.com" required>
        </div>
      </div>
      <div class="form-field">
        <label class="form-label">Message</label>
        <textarea class="form-textarea" name="message" placeholder="Ton message..." required></textarea>
      </div>
      <button class="form-submit" type="submit">Envoyer ‚Üí</button>
      <div class="form-success" id="form-success">‚úì Message envoy√© ! Je te r√©ponds bient√¥t.</div>
    </form>
  </div>
  <div class="contact-bottom">
    <span>¬© 2025 WorldTime</span>
    <span>Fait avec ‚ô• et JavaScript</span>
  </div>
</section>

<script>
const COUNTRIES = [
  // Europe
  { name:"France", flag:"üá´üá∑", tz:"Europe/Paris", region:"Europe", code:"FR" },
  { name:"Allemagne", flag:"üá©üá™", tz:"Europe/Berlin", region:"Europe", code:"DE" },
  { name:"Espagne", flag:"üá™üá∏", tz:"Europe/Madrid", region:"Europe", code:"ES" },
  { name:"Italie", flag:"üáÆüáπ", tz:"Europe/Rome", region:"Europe", code:"IT" },
  { name:"Royaume-Uni", flag:"üá¨üáß", tz:"Europe/London", region:"Europe", code:"GB" },
  { name:"Portugal", flag:"üáµüáπ", tz:"Europe/Lisbon", region:"Europe", code:"PT" },
  { name:"Pays-Bas", flag:"üá≥üá±", tz:"Europe/Amsterdam", region:"Europe", code:"NL" },
  { name:"Belgique", flag:"üáßüá™", tz:"Europe/Brussels", region:"Europe", code:"BE" },
  { name:"Suisse", flag:"üá®üá≠", tz:"Europe/Zurich", region:"Europe", code:"CH" },
  { name:"Autriche", flag:"üá¶üáπ", tz:"Europe/Vienna", region:"Europe", code:"AT" },
  { name:"Su√®de", flag:"üá∏üá™", tz:"Europe/Stockholm", region:"Europe", code:"SE" },
  { name:"Norv√®ge", flag:"üá≥üá¥", tz:"Europe/Oslo", region:"Europe", code:"NO" },
  { name:"Danemark", flag:"üá©üá∞", tz:"Europe/Copenhagen", region:"Europe", code:"DK" },
  { name:"Finlande", flag:"üá´üáÆ", tz:"Europe/Helsinki", region:"Europe", code:"FI" },
  { name:"Pologne", flag:"üáµüá±", tz:"Europe/Warsaw", region:"Europe", code:"PL" },
  { name:"Tch√©quie", flag:"üá®üáø", tz:"Europe/Prague", region:"Europe", code:"CZ" },
  { name:"Hongrie", flag:"üá≠üá∫", tz:"Europe/Budapest", region:"Europe", code:"HU" },
  { name:"Roumanie", flag:"üá∑üá¥", tz:"Europe/Bucharest", region:"Europe", code:"RO" },
  { name:"Gr√®ce", flag:"üá¨üá∑", tz:"Europe/Athens", region:"Europe", code:"GR" },
  { name:"Ukraine", flag:"üá∫üá¶", tz:"Europe/Kyiv", region:"Europe", code:"UA" },
  { name:"Russie", flag:"üá∑üá∫", tz:"Europe/Moscow", region:"Europe", code:"RU" },
  { name:"Turquie", flag:"üáπüá∑", tz:"Europe/Istanbul", region:"Europe", code:"TR" },
  { name:"Irlande", flag:"üáÆüá™", tz:"Europe/Dublin", region:"Europe", code:"IE" },
  { name:"Serbie", flag:"üá∑üá∏", tz:"Europe/Belgrade", region:"Europe", code:"RS" },
  { name:"Croatie", flag:"üá≠üá∑", tz:"Europe/Zagreb", region:"Europe", code:"HR" },
  { name:"Bulgarie", flag:"üáßüá¨", tz:"Europe/Sofia", region:"Europe", code:"BG" },
  { name:"Islande", flag:"üáÆüá∏", tz:"Atlantic/Reykjavik", region:"Europe", code:"IS" },
  { name:"Luxembourg", flag:"üá±üá∫", tz:"Europe/Luxembourg", region:"Europe", code:"LU" },
  { name:"Slovaquie", flag:"üá∏üá∞", tz:"Europe/Bratislava", region:"Europe", code:"SK" },
  { name:"Slov√©nie", flag:"üá∏üáÆ", tz:"Europe/Ljubljana", region:"Europe", code:"SI" },
  { name:"Estonie", flag:"üá™üá™", tz:"Europe/Tallinn", region:"Europe", code:"EE" },
  { name:"Lettonie", flag:"üá±üáª", tz:"Europe/Riga", region:"Europe", code:"LV" },
  { name:"Lituanie", flag:"üá±üáπ", tz:"Europe/Vilnius", region:"Europe", code:"LT" },
  { name:"Bi√©lorussie", flag:"üáßüáæ", tz:"Europe/Minsk", region:"Europe", code:"BY" },
  { name:"Moldavie", flag:"üá≤üá©", tz:"Europe/Chisinau", region:"Europe", code:"MD" },
  { name:"Albanie", flag:"üá¶üá±", tz:"Europe/Tirane", region:"Europe", code:"AL" },
  { name:"Bosnie-Herz√©govine", flag:"üáßüá¶", tz:"Europe/Sarajevo", region:"Europe", code:"BA" },
  { name:"Mac√©doine du Nord", flag:"üá≤üá∞", tz:"Europe/Skopje", region:"Europe", code:"MK" },
  { name:"Mont√©n√©gro", flag:"üá≤üá™", tz:"Europe/Podgorica", region:"Europe", code:"ME" },
  { name:"Kosovo", flag:"üáΩüá∞", tz:"Europe/Belgrade", region:"Europe", code:"XK" },
  { name:"Malte", flag:"üá≤üáπ", tz:"Europe/Malta", region:"Europe", code:"MT" },
  { name:"Chypre", flag:"üá®üáæ", tz:"Asia/Nicosia", region:"Europe", code:"CY" },
  { name:"Andorre", flag:"üá¶üá©", tz:"Europe/Andorra", region:"Europe", code:"AD" },
  { name:"Monaco", flag:"üá≤üá®", tz:"Europe/Monaco", region:"Europe", code:"MC" },
  { name:"Liechtenstein", flag:"üá±üáÆ", tz:"Europe/Vaduz", region:"Europe", code:"LI" },
  { name:"Saint-Marin", flag:"üá∏üá≤", tz:"Europe/San_Marino", region:"Europe", code:"SM" },
  { name:"Vatican", flag:"üáªüá¶", tz:"Europe/Vatican", region:"Europe", code:"VA" },
  // Am√©rique
  { name:"Canada (Est)", flag:"üá®üá¶", tz:"America/Toronto", region:"Am√©rique", code:"CA" },
  { name:"Canada (Atlantique)", flag:"üá®üá¶", tz:"America/Halifax", region:"Am√©rique", code:"CA" },
  { name:"Canada (Ouest)", flag:"üá®üá¶", tz:"America/Vancouver", region:"Am√©rique", code:"CA" },
  { name:"√âtats-Unis (Est)", flag:"üá∫üá∏", tz:"America/New_York", region:"Am√©rique", code:"US" },
  { name:"√âtats-Unis (Central)", flag:"üá∫üá∏", tz:"America/Chicago", region:"Am√©rique", code:"US" },
  { name:"√âtats-Unis (Ouest)", flag:"üá∫üá∏", tz:"America/Los_Angeles", region:"Am√©rique", code:"US" },
  { name:"√âtats-Unis (Alaska)", flag:"üá∫üá∏", tz:"America/Anchorage", region:"Am√©rique", code:"US" },
  { name:"Mexique", flag:"üá≤üáΩ", tz:"America/Mexico_City", region:"Am√©rique", code:"MX" },
  { name:"Br√©sil", flag:"üáßüá∑", tz:"America/Sao_Paulo", region:"Am√©rique", code:"BR" },
  { name:"Argentine", flag:"üá¶üá∑", tz:"America/Argentina/Buenos_Aires", region:"Am√©rique", code:"AR" },
  { name:"Colombie", flag:"üá®üá¥", tz:"America/Bogota", region:"Am√©rique", code:"CO" },
  { name:"Chili", flag:"üá®üá±", tz:"America/Santiago", region:"Am√©rique", code:"CL" },
  { name:"P√©rou", flag:"üáµüá™", tz:"America/Lima", region:"Am√©rique", code:"PE" },
  { name:"Venezuela", flag:"üáªüá™", tz:"America/Caracas", region:"Am√©rique", code:"VE" },
  { name:"Cuba", flag:"üá®üá∫", tz:"America/Havana", region:"Am√©rique", code:"CU" },
  { name:"√âquateur", flag:"üá™üá®", tz:"America/Guayaquil", region:"Am√©rique", code:"EC" },
  { name:"Bolivie", flag:"üáßüá¥", tz:"America/La_Paz", region:"Am√©rique", code:"BO" },
  { name:"Uruguay", flag:"üá∫üáæ", tz:"America/Montevideo", region:"Am√©rique", code:"UY" },
  { name:"Paraguay", flag:"üáµüáæ", tz:"America/Asuncion", region:"Am√©rique", code:"PY" },
  { name:"Jama√Øque", flag:"üáØüá≤", tz:"America/Jamaica", region:"Am√©rique", code:"JM" },
  { name:"Ha√Øti", flag:"üá≠üáπ", tz:"America/Port-au-Prince", region:"Am√©rique", code:"HT" },
  { name:"Costa Rica", flag:"üá®üá∑", tz:"America/Costa_Rica", region:"Am√©rique", code:"CR" },
  { name:"Panama", flag:"üáµüá¶", tz:"America/Panama", region:"Am√©rique", code:"PA" },
  { name:"Guatemala", flag:"üá¨üáπ", tz:"America/Guatemala", region:"Am√©rique", code:"GT" },
  { name:"Honduras", flag:"üá≠üá≥", tz:"America/Tegucigalpa", region:"Am√©rique", code:"HN" },
  { name:"El Salvador", flag:"üá∏üáª", tz:"America/El_Salvador", region:"Am√©rique", code:"SV" },
  { name:"Nicaragua", flag:"üá≥üáÆ", tz:"America/Managua", region:"Am√©rique", code:"NI" },
  { name:"Belize", flag:"üáßüáø", tz:"America/Belize", region:"Am√©rique", code:"BZ" },
  { name:"R√©publique dominicaine", flag:"üá©üá¥", tz:"America/Santo_Domingo", region:"Am√©rique", code:"DO" },
  { name:"Porto Rico", flag:"üáµüá∑", tz:"America/Puerto_Rico", region:"Am√©rique", code:"PR" },
  { name:"Trinit√©-et-Tobago", flag:"üáπüáπ", tz:"America/Port_of_Spain", region:"Am√©rique", code:"TT" },
  { name:"Guyana", flag:"üá¨üáæ", tz:"America/Guyana", region:"Am√©rique", code:"GY" },
  { name:"Suriname", flag:"üá∏üá∑", tz:"America/Paramaribo", region:"Am√©rique", code:"SR" },
  { name:"Guyana fran√ßais", flag:"üá¨üá´", tz:"America/Cayenne", region:"Am√©rique", code:"GF" },
  { name:"Bahamas", flag:"üáßüá∏", tz:"America/Nassau", region:"Am√©rique", code:"BS" },
  { name:"Barbade", flag:"üáßüáß", tz:"America/Barbados", region:"Am√©rique", code:"BB" },
  { name:"Sainte-Lucie", flag:"üá±üá®", tz:"America/St_Lucia", region:"Am√©rique", code:"LC" },
  { name:"Saint-Vincent-et-les-Grenadines", flag:"üáªüá®", tz:"America/St_Vincent", region:"Am√©rique", code:"VC" },
  { name:"Grenade", flag:"üá¨üá©", tz:"America/Grenada", region:"Am√©rique", code:"GD" },
  { name:"Antigua-et-Barbuda", flag:"üá¶üá¨", tz:"America/Antigua", region:"Am√©rique", code:"AG" },
  { name:"Saint-Christophe-et-Ni√©v√®s", flag:"üá∞üá≥", tz:"America/St_Kitts", region:"Am√©rique", code:"KN" },
  { name:"Dominique", flag:"üá©üá≤", tz:"America/Dominica", region:"Am√©rique", code:"DM" },
  { name:"Martinique", flag:"üá≤üá∂", tz:"America/Martinique", region:"Am√©rique", code:"MQ" },
  { name:"Guadeloupe", flag:"üá¨üáµ", tz:"America/Guadeloupe", region:"Am√©rique", code:"GP" },
  // Asie
  { name:"Chine", flag:"üá®üá≥", tz:"Asia/Shanghai", region:"Asie", code:"CN" },
  { name:"Japon", flag:"üáØüáµ", tz:"Asia/Tokyo", region:"Asie", code:"JP" },
  { name:"Inde", flag:"üáÆüá≥", tz:"Asia/Kolkata", region:"Asie", code:"IN" },
  { name:"Cor√©e du Sud", flag:"üá∞üá∑", tz:"Asia/Seoul", region:"Asie", code:"KR" },
  { name:"Indon√©sie", flag:"üáÆüá©", tz:"Asia/Jakarta", region:"Asie", code:"ID" },
  { name:"Tha√Ølande", flag:"üáπüá≠", tz:"Asia/Bangkok", region:"Asie", code:"TH" },
  { name:"Vietnam", flag:"üáªüá≥", tz:"Asia/Ho_Chi_Minh", region:"Asie", code:"VN" },
  { name:"Philippines", flag:"üáµüá≠", tz:"Asia/Manila", region:"Asie", code:"PH" },
  { name:"Malaisie", flag:"üá≤üáæ", tz:"Asia/Kuala_Lumpur", region:"Asie", code:"MY" },
  { name:"Singapour", flag:"üá∏üá¨", tz:"Asia/Singapore", region:"Asie", code:"SG" },
  { name:"Pakistan", flag:"üáµüá∞", tz:"Asia/Karachi", region:"Asie", code:"PK" },
  { name:"Bangladesh", flag:"üáßüá©", tz:"Asia/Dhaka", region:"Asie", code:"BD" },
  { name:"Iran", flag:"üáÆüá∑", tz:"Asia/Tehran", region:"Asie", code:"IR" },
  { name:"Irak", flag:"üáÆüá∂", tz:"Asia/Baghdad", region:"Asie", code:"IQ" },
  { name:"Arabie Saoudite", flag:"üá∏üá¶", tz:"Asia/Riyadh", region:"Asie", code:"SA" },
  { name:"√âmirats Arabes Unis", flag:"üá¶üá™", tz:"Asia/Dubai", region:"Asie", code:"AE" },
  { name:"Isra√´l", flag:"üáÆüá±", tz:"Asia/Jerusalem", region:"Asie", code:"IL" },
  { name:"Kazakhstan", flag:"üá∞üáø", tz:"Asia/Almaty", region:"Asie", code:"KZ" },
  { name:"Myanmar", flag:"üá≤üá≤", tz:"Asia/Rangoon", region:"Asie", code:"MM" },
  { name:"N√©pal", flag:"üá≥üáµ", tz:"Asia/Kathmandu", region:"Asie", code:"NP" },
  { name:"Sri Lanka", flag:"üá±üá∞", tz:"Asia/Colombo", region:"Asie", code:"LK" },
  { name:"Qatar", flag:"üá∂üá¶", tz:"Asia/Qatar", region:"Asie", code:"QA" },
  { name:"Kowe√Øt", flag:"üá∞üáº", tz:"Asia/Kuwait", region:"Asie", code:"KW" },
  { name:"Jordanie", flag:"üáØüá¥", tz:"Asia/Amman", region:"Asie", code:"JO" },
  { name:"Liban", flag:"üá±üáß", tz:"Asia/Beirut", region:"Asie", code:"LB" },
  { name:"G√©orgie", flag:"üá¨üá™", tz:"Asia/Tbilisi", region:"Asie", code:"GE" },
  { name:"Arm√©nie", flag:"üá¶üá≤", tz:"Asia/Yerevan", region:"Asie", code:"AM" },
  { name:"Azerba√Ødjan", flag:"üá¶üáø", tz:"Asia/Baku", region:"Asie", code:"AZ" },
  { name:"Ta√Øwan", flag:"üáπüáº", tz:"Asia/Taipei", region:"Asie", code:"TW" },
  { name:"Hong Kong", flag:"üá≠üá∞", tz:"Asia/Hong_Kong", region:"Asie", code:"HK" },
  { name:"Mongolie", flag:"üá≤üá≥", tz:"Asia/Ulaanbaatar", region:"Asie", code:"MN" },
  { name:"Cambodge", flag:"üá∞üá≠", tz:"Asia/Phnom_Penh", region:"Asie", code:"KH" },
  { name:"Laos", flag:"üá±üá¶", tz:"Asia/Vientiane", region:"Asie", code:"LA" },
  { name:"Cor√©e du Nord", flag:"üá∞üáµ", tz:"Asia/Pyongyang", region:"Asie", code:"KP" },
  { name:"Afghanistan", flag:"üá¶üá´", tz:"Asia/Kabul", region:"Asie", code:"AF" },
  { name:"Ouzb√©kistan", flag:"üá∫üáø", tz:"Asia/Tashkent", region:"Asie", code:"UZ" },
  { name:"Turkm√©nistan", flag:"üáπüá≤", tz:"Asia/Ashgabat", region:"Asie", code:"TM" },
  { name:"Tadjikistan", flag:"üáπüáØ", tz:"Asia/Dushanbe", region:"Asie", code:"TJ" },
  { name:"Kirghizstan", flag:"üá∞üá¨", tz:"Asia/Bishkek", region:"Asie", code:"KG" },
  { name:"Oman", flag:"üá¥üá≤", tz:"Asia/Muscat", region:"Asie", code:"OM" },
  { name:"Bahre√Øn", flag:"üáßüá≠", tz:"Asia/Bahrain", region:"Asie", code:"BH" },
  { name:"Y√©men", flag:"üáæüá™", tz:"Asia/Aden", region:"Asie", code:"YE" },
  { name:"Syrie", flag:"üá∏üáæ", tz:"Asia/Damascus", region:"Asie", code:"SY" },
  { name:"Palestine", flag:"üáµüá∏", tz:"Asia/Gaza", region:"Asie", code:"PS" },
  { name:"Bhoutan", flag:"üáßüáπ", tz:"Asia/Thimphu", region:"Asie", code:"BT" },
  { name:"Maldives", flag:"üá≤üáª", tz:"Indian/Maldives", region:"Asie", code:"MV" },
  { name:"Brunei", flag:"üáßüá≥", tz:"Asia/Brunei", region:"Asie", code:"BN" },
  { name:"Timor oriental", flag:"üáπüá±", tz:"Asia/Dili", region:"Asie", code:"TL" },
  { name:"Macao", flag:"üá≤üá¥", tz:"Asia/Macau", region:"Asie", code:"MO" },
  // Afrique
  { name:"Nigeria", flag:"üá≥üá¨", tz:"Africa/Lagos", region:"Afrique", code:"NG" },
  { name:"√âgypte", flag:"üá™üá¨", tz:"Africa/Cairo", region:"Afrique", code:"EG" },
  { name:"Afrique du Sud", flag:"üáøüá¶", tz:"Africa/Johannesburg", region:"Afrique", code:"ZA" },
  { name:"√âthiopie", flag:"üá™üáπ", tz:"Africa/Addis_Ababa", region:"Afrique", code:"ET" },
  { name:"Kenya", flag:"üá∞üá™", tz:"Africa/Nairobi", region:"Afrique", code:"KE" },
  { name:"Ghana", flag:"üá¨üá≠", tz:"Africa/Accra", region:"Afrique", code:"GH" },
  { name:"Maroc", flag:"üá≤üá¶", tz:"Africa/Casablanca", region:"Afrique", code:"MA" },
  { name:"Alg√©rie", flag:"üá©üáø", tz:"Africa/Algiers", region:"Afrique", code:"DZ" },
  { name:"Tunisie", flag:"üáπüá≥", tz:"Africa/Tunis", region:"Afrique", code:"TN" },
  { name:"S√©n√©gal", flag:"üá∏üá≥", tz:"Africa/Dakar", region:"Afrique", code:"SN" },
  { name:"C√¥te d'Ivoire", flag:"üá®üáÆ", tz:"Africa/Abidjan", region:"Afrique", code:"CI" },
  { name:"Cameroun", flag:"üá®üá≤", tz:"Africa/Douala", region:"Afrique", code:"CM" },
  { name:"Tanzanie", flag:"üáπüáø", tz:"Africa/Dar_es_Salaam", region:"Afrique", code:"TZ" },
  { name:"Angola", flag:"üá¶üá¥", tz:"Africa/Luanda", region:"Afrique", code:"AO" },
  { name:"Madagascar", flag:"üá≤üá¨", tz:"Indian/Antananarivo", region:"Afrique", code:"MG" },
  { name:"Soudan", flag:"üá∏üá©", tz:"Africa/Khartoum", region:"Afrique", code:"SD" },
  { name:"Libye", flag:"üá±üáæ", tz:"Africa/Tripoli", region:"Afrique", code:"LY" },
  { name:"Mozambique", flag:"üá≤üáø", tz:"Africa/Maputo", region:"Afrique", code:"MZ" },
  { name:"Congo (R√©p. d√©m.)", flag:"üá®üá©", tz:"Africa/Kinshasa", region:"Afrique", code:"CD" },
  { name:"Congo (R√©p.)", flag:"üá®üá¨", tz:"Africa/Brazzaville", region:"Afrique", code:"CG" },
  { name:"Ouganda", flag:"üá∫üá¨", tz:"Africa/Kampala", region:"Afrique", code:"UG" },
  { name:"Rwanda", flag:"üá∑üáº", tz:"Africa/Kigali", region:"Afrique", code:"RW" },
  { name:"Zambie", flag:"üáøüá≤", tz:"Africa/Lusaka", region:"Afrique", code:"ZM" },
  { name:"Zimbabwe", flag:"üáøüáº", tz:"Africa/Harare", region:"Afrique", code:"ZW" },
  { name:"Mali", flag:"üá≤üá±", tz:"Africa/Bamako", region:"Afrique", code:"ML" },
  { name:"Burkina Faso", flag:"üáßüá´", tz:"Africa/Ouagadougou", region:"Afrique", code:"BF" },
  { name:"Niger", flag:"üá≥üá™", tz:"Africa/Niamey", region:"Afrique", code:"NE" },
  { name:"Tchad", flag:"üáπüá©", tz:"Africa/Ndjamena", region:"Afrique", code:"TD" },
  { name:"Soudan du Sud", flag:"üá∏üá∏", tz:"Africa/Juba", region:"Afrique", code:"SS" },
  { name:"Somalie", flag:"üá∏üá¥", tz:"Africa/Mogadishu", region:"Afrique", code:"SO" },
  { name:"√ârythr√©e", flag:"üá™üá∑", tz:"Africa/Asmara", region:"Afrique", code:"ER" },
  { name:"Djibouti", flag:"üá©üáØ", tz:"Africa/Djibouti", region:"Afrique", code:"DJ" },
  { name:"Namibie", flag:"üá≥üá¶", tz:"Africa/Windhoek", region:"Afrique", code:"NA" },
  { name:"Botswana", flag:"üáßüáº", tz:"Africa/Gaborone", region:"Afrique", code:"BW" },
  { name:"Malawi", flag:"üá≤üáº", tz:"Africa/Blantyre", region:"Afrique", code:"MW" },
  { name:"Eswatini", flag:"üá∏üáø", tz:"Africa/Mbabane", region:"Afrique", code:"SZ" },
  { name:"Lesotho", flag:"üá±üá∏", tz:"Africa/Maseru", region:"Afrique", code:"LS" },
  { name:"Gabon", flag:"üá¨üá¶", tz:"Africa/Libreville", region:"Afrique", code:"GA" },
  { name:"Guin√©e √©quatoriale", flag:"üá¨üá∂", tz:"Africa/Malabo", region:"Afrique", code:"GQ" },
  { name:"R√©publique centrafricaine", flag:"üá®üá´", tz:"Africa/Bangui", region:"Afrique", code:"CF" },
  { name:"Guin√©e", flag:"üá¨üá≥", tz:"Africa/Conakry", region:"Afrique", code:"GN" },
  { name:"Guin√©e-Bissau", flag:"üá¨üáº", tz:"Africa/Bissau", region:"Afrique", code:"GW" },
  { name:"Sierra Leone", flag:"üá∏üá±", tz:"Africa/Freetown", region:"Afrique", code:"SL" },
  { name:"Lib√©ria", flag:"üá±üá∑", tz:"Africa/Monrovia", region:"Afrique", code:"LR" },
  { name:"Togo", flag:"üáπüá¨", tz:"Africa/Lome", region:"Afrique", code:"TG" },
  { name:"B√©nin", flag:"üáßüáØ", tz:"Africa/Porto-Novo", region:"Afrique", code:"BJ" },
  { name:"Gambie", flag:"üá¨üá≤", tz:"Africa/Banjul", region:"Afrique", code:"GM" },
  { name:"Cap-Vert", flag:"üá®üáª", tz:"Atlantic/Cape_Verde", region:"Afrique", code:"CV" },
  { name:"Maurice", flag:"üá≤üá∫", tz:"Indian/Mauritius", region:"Afrique", code:"MU" },
  { name:"Seychelles", flag:"üá∏üá®", tz:"Indian/Mahe", region:"Afrique", code:"SC" },
  { name:"Comores", flag:"üá∞üá≤", tz:"Indian/Comoro", region:"Afrique", code:"KM" },
  { name:"S√£o Tom√©-et-Pr√≠ncipe", flag:"üá∏üáπ", tz:"Africa/Sao_Tome", region:"Afrique", code:"ST" },
  { name:"Burundi", flag:"üáßüáÆ", tz:"Africa/Bujumbura", region:"Afrique", code:"BI" },
  { name:"Mauritanie", flag:"üá≤üá∑", tz:"Africa/Nouakchott", region:"Afrique", code:"MR" },
  // Oc√©anie
  { name:"Australie (Sydney)", flag:"üá¶üá∫", tz:"Australia/Sydney", region:"Oc√©anie", code:"AU" },
  { name:"Australie (Perth)", flag:"üá¶üá∫", tz:"Australia/Perth", region:"Oc√©anie", code:"AU" },
  { name:"Australie (Brisbane)", flag:"üá¶üá∫", tz:"Australia/Brisbane", region:"Oc√©anie", code:"AU" },
  { name:"Australie (Ad√©la√Øde)", flag:"üá¶üá∫", tz:"Australia/Adelaide", region:"Oc√©anie", code:"AU" },
  { name:"Australie (Darwin)", flag:"üá¶üá∫", tz:"Australia/Darwin", region:"Oc√©anie", code:"AU" },
  { name:"Nouvelle-Z√©lande", flag:"üá≥üáø", tz:"Pacific/Auckland", region:"Oc√©anie", code:"NZ" },
  { name:"Fidji", flag:"üá´üáØ", tz:"Pacific/Fiji", region:"Oc√©anie", code:"FJ" },
  { name:"Papouasie-N.-G.", flag:"üáµüá¨", tz:"Pacific/Port_Moresby", region:"Oc√©anie", code:"PG" },
  { name:"Hawaii", flag:"üá∫üá∏", tz:"Pacific/Honolulu", region:"Oc√©anie", code:"US" },
  { name:"Polyn√©sie Fr.", flag:"üáµüá´", tz:"Pacific/Tahiti", region:"Oc√©anie", code:"PF" },
  { name:"Nouvelle-Cal√©donie", flag:"üá≥üá®", tz:"Pacific/Noumea", region:"Oc√©anie", code:"NC" },
  { name:"Vanuatu", flag:"üáªüá∫", tz:"Pacific/Efate", region:"Oc√©anie", code:"VU" },
  { name:"√éles Salomon", flag:"üá∏üáß", tz:"Pacific/Guadalcanal", region:"Oc√©anie", code:"SB" },
  { name:"Samoa", flag:"üáºüá∏", tz:"Pacific/Apia", region:"Oc√©anie", code:"WS" },
  { name:"Tonga", flag:"üáπüá¥", tz:"Pacific/Tongatapu", region:"Oc√©anie", code:"TO" },
  { name:"Kiribati", flag:"üá∞üáÆ", tz:"Pacific/Tarawa", region:"Oc√©anie", code:"KI" },
  { name:"Micron√©sie", flag:"üá´üá≤", tz:"Pacific/Pohnpei", region:"Oc√©anie", code:"FM" },
  { name:"Palaos", flag:"üáµüáº", tz:"Pacific/Palau", region:"Oc√©anie", code:"PW" },
  { name:"√éles Marshall", flag:"üá≤üá≠", tz:"Pacific/Majuro", region:"Oc√©anie", code:"MH" },
  { name:"Nauru", flag:"üá≥üá∑", tz:"Pacific/Nauru", region:"Oc√©anie", code:"NR" },
  { name:"Tuvalu", flag:"üáπüáª", tz:"Pacific/Funafuti", region:"Oc√©anie", code:"TV" },
  { name:"Niue", flag:"üá≥üá∫", tz:"Pacific/Niue", region:"Oc√©anie", code:"NU" },
  { name:"√éles Cook", flag:"üá®üá∞", tz:"Pacific/Rarotonga", region:"Oc√©anie", code:"CK" },
  { name:"Guam", flag:"üá¨üá∫", tz:"Pacific/Guam", region:"Oc√©anie", code:"GU" },
  { name:"Samoa am√©ricaines", flag:"üá¶üá∏", tz:"Pacific/Pago_Pago", region:"Oc√©anie", code:"AS" },
];

// ‚îÄ‚îÄ‚îÄ Supabase ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SUPABASE_URL = "https://dphtlyrjgzgctcjzbzaf.supabase.co";
const SUPABASE_KEY = "sb_publishable_ydPg-wmTyUhq9fweC_JwUw_WFZx1nf_";

async function sbFetch(path, options = {}) {
  return fetch(`${SUPABASE_URL}/rest/v1/${path}`, {
    ...options,
    headers: {
      "apikey": SUPABASE_KEY,
      "Authorization": `Bearer ${SUPABASE_KEY}`,
      "Content-Type": "application/json",
      "Prefer": "return=minimal",
      ...options.headers
    }
  });
}

async function registerVisit() {
  if (!myCode) return;
  const match = COUNTRIES.find(c => c.code === myCode);
  const flag = match ? match.flag : "üåç";
  await sbFetch("visitors", {
    method: "POST",
    body: JSON.stringify({ country: myName, country_code: myCode, flag, timezone: myTz })
  });
}

async function loadVisitors() {
  try {
    const countRes = await sbFetch("visitors?select=id", { headers: { "Prefer": "count=exact" } });
    const total = countRes.headers.get("content-range")?.split("/")?.[1] || "0";
    document.getElementById("visit-count").textContent = Number(total).toLocaleString("fr-FR");

    const res = await sbFetch("visitors?select=flag,country,country_code&order=visited_at.desc&limit=50");
    const data = await res.json();
    const seen = new Set();
    const unique = data.filter(v => {
      if (seen.has(v.country_code)) return false;
      seen.add(v.country_code);
      return true;
    }).slice(0, 15);

    const list = document.getElementById("visitors-list");
    if (!unique.length) {
      list.innerHTML = `<span style="font-family:'DM Mono',monospace;font-size:0.68rem;color:rgba(245,240,232,0.3);">Aucun visiteur encore</span>`;
      return;
    }
    list.innerHTML = unique.map(v => `
      <div class="visitor-chip"><span class="chip-flag">${v.flag}</span><span>${v.country}</span></div>
    `).join("");
  } catch(e) { console.error("Supabase error:", e); }
}

// ‚îÄ‚îÄ‚îÄ Contact Form ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById("contact-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const btn = e.target.querySelector(".form-submit");
  btn.disabled = true;
  btn.textContent = "Envoi...";
  try {
    const res = await fetch("https://formspree.io/f/mgolrnyb", {
      method: "POST",
      headers: { "Accept": "application/json" },
      body: new FormData(e.target)
    });
    if (res.ok) {
      e.target.reset();
      document.getElementById("form-success").classList.add("show");
    } else {
      btn.textContent = "Erreur, r√©essaie";
    }
    btn.disabled = false;
    btn.textContent = "Envoyer ‚Üí";
  } catch {
    btn.textContent = "Erreur, r√©essaie";
    btn.disabled = false;
  }
});

// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let myCode = null;
let myTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
let myName = "";
let currentFilter = "all";
let searchQuery = "";
let liveCards = [];

function fmt(tz, opts) { return new Date().toLocaleString("fr-FR", { timeZone: tz, ...opts }); }
function getTime(tz) { return fmt(tz, { hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false }); }
function getDate(tz) { return fmt(tz, { weekday:"long", day:"numeric", month:"long" }); }

function getOffset(tz) {
  const d = new Date();
  const tzDate = new Date(d.toLocaleString("en-US", { timeZone: tz }));
  const utcDate = new Date(d.toLocaleString("en-US", { timeZone: "UTC" }));
  const diff = (tzDate - utcDate) / 3600000;
  const sign = diff >= 0 ? "+" : "-";
  const abs = Math.abs(diff);
  const h = Math.floor(abs);
  const m = Math.round((abs - h) * 60);
  return `UTC${sign}${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
}

function getDayPct(tz) {
  const d = new Date();
  const tzDate = new Date(d.toLocaleString("en-US", { timeZone: tz }));
  return ((tzDate.getHours() + tzDate.getMinutes()/60) / 24) * 100;
}

function isMe(c) { return myCode && c.code === myCode; }

async function detectLocation() {
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    myCode = data.country_code;
    myTz = data.timezone || myTz;
    myName = data.country_name || "";
    document.getElementById("my-location").innerHTML = `üìç Vous √™tes ici : <strong>${myName}</strong>`;
  } catch {
    document.getElementById("my-location").innerHTML = `üìç <strong>${myTz}</strong>`;
  }
}

function updateHero() {
  document.getElementById("hero-time").textContent = getTime(myTz);
  document.getElementById("hero-date").textContent = getDate(myTz);
  document.getElementById("hero-tz").textContent = getOffset(myTz) + " ‚Äî " + myTz;
  const match = COUNTRIES.find(c => c.tz === myTz) || COUNTRIES.find(c => c.code === myCode);
  document.getElementById("hero-country").textContent = match ? match.flag + " " + match.name : (myName || myTz);
}

function buildGrid() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  liveCards = [];
  let list = COUNTRIES.filter(c => {
    const r = currentFilter === "all" || c.region === currentFilter;
    const s = !searchQuery || c.name.toLowerCase().includes(searchQuery.toLowerCase());
    return r && s;
  });
  list.sort((a,b) => (isMe(a) ? -1 : isMe(b) ? 1 : 0));
  document.getElementById("count").textContent = list.length + " pays";
  if (!list.length) {
    grid.innerHTML = `<div class="empty-state">Aucun r√©sultat pour "${searchQuery}"</div>`;
    return;
  }
  list.forEach(c => {
    const div = document.createElement("div");
    div.className = "card" + (isMe(c) ? " me" : "");
    div.innerHTML = `
      <div class="card-top">
        <span class="card-flag">${c.flag}</span>
        <span class="card-offset">${getOffset(c.tz)}</span>
      </div>
      <div class="card-country">${c.name}<span class="you-badge">Vous ici</span></div>
      <div class="card-time">${getTime(c.tz)}</div>
      <div class="card-date">${getDate(c.tz)}</div>
      <div class="card-tz">${c.tz}</div>
      <div class="day-bar"><div class="day-fill" style="width:${getDayPct(c.tz)}%"></div></div>
    `;
    grid.appendChild(div);
    liveCards.push({ el: div, tz: c.tz });
  });
}

function tick() {
  updateHero();
  liveCards.forEach(({ el, tz }) => {
    const t = el.querySelector(".card-time");
    const d = el.querySelector(".card-date");
    const f = el.querySelector(".day-fill");
    if (t) t.textContent = getTime(tz);
    if (d) d.textContent = getDate(tz);
    if (f) f.style.width = getDayPct(tz) + "%";
  });
}

document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.region;
    buildGrid();
  });
});

document.getElementById("search").addEventListener("input", e => {
  searchQuery = e.target.value;
  buildGrid();
});

(async () => {
  await detectLocation();
  updateHero();
  buildGrid();
  await registerVisit();
  await loadVisitors();
  setInterval(tick, 1000);
  setInterval(loadVisitors, 15000);
})();
</script>
</body>
</html>
